<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-05-29">

<title>Análisis de Supervivencia con adopciones de gatos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Proyecto_Final_files/libs/clipboard/clipboard.min.js"></script>
<script src="Proyecto_Final_files/libs/quarto-html/quarto.js"></script>
<script src="Proyecto_Final_files/libs/quarto-html/popper.min.js"></script>
<script src="Proyecto_Final_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Proyecto_Final_files/libs/quarto-html/anchor.min.js"></script>
<link href="Proyecto_Final_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Proyecto_Final_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Proyecto_Final_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Proyecto_Final_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Proyecto_Final_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="Proyecto_Final_files/libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="Proyecto_Final_files/libs/viz-1.8.2/viz.js"></script>
<link href="Proyecto_Final_files/libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="Proyecto_Final_files/libs/grViz-binding-1.0.11/grViz.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Análisis de Supervivencia con adopciones de gatos</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Sara Luz valenzuela Camacho </p>
             <p>Gabriela Patricia Venegas Sánchez </p>
             <p>José Antonio Tapia Godínez </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 29, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="proyecto-final" class="level1">
<h1>Proyecto Final</h1>
<section id="planteamiento" class="level2">
<h2 class="anchored" data-anchor-id="planteamiento">Planteamiento</h2>
<p>En el presente trabajo analizamos un problema tomado de las notas del curso de Statistical Rethinking del 2019 de McElreath. El objetivo es determinar si a los gatos de color negro les toma más tiempo ser adoptados.</p>
<p>Los modelos utilizados para tratar este tipo de información se conocen como modelos de supervivencia. Estos modelos estadísticos se emplean cuando la variable objetivo que se desea predecir es el tiempo transcurrido hasta que ocurre un evento de interés. Los eventos de interés son eventos discretos (contables) y queremos saber la taza a la que suceden estos eventos. Por lo tanto, son todos valores reales positivos.</p>
<p>Para este proyecto trabajaremos con la base de datos <code>AustinCats</code> de la librería <code>rethinking</code>.</p>
<p>La base de datos cuenta con 22,356 registros individuales de gatos que han pasado por el “Centro de Animales de Austin, TX” y contiene 9 variables relacionadas con los gatos y su paso por el refugio.</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-2_1fda0c99d57f17bc66dacd6a1e809a08">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(AustinCats)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(AustinCats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 22,356
Columns: 9
$ id            &lt;fct&gt; A730601, A679549, A683656, A709749, A733551, A756485, A7…
$ days_to_event &lt;int&gt; 1, 25, 4, 41, 9, 4, 4, 5, 24, 2, 34, 27, 3, 151, 106, 4,…
$ date_out      &lt;fct&gt; 07/08/2016 09:00:00 AM, 06/16/2014 01:54:00 PM, 07/17/20…
$ out_event     &lt;fct&gt; Transfer, Transfer, Adoption, Transfer, Transfer, Adopti…
$ date_in       &lt;fct&gt; 07/07/2016 12:11:00 PM, 05/22/2014 03:43:00 PM, 07/13/20…
$ in_event      &lt;fct&gt; Stray, Stray, Stray, Stray, Stray, Stray, Stray, Owner S…
$ breed         &lt;fct&gt; Domestic Shorthair Mix, Domestic Shorthair Mix, Snowshoe…
$ color         &lt;fct&gt; Blue Tabby, Black/White, Lynx Point, Calico, Brown Tabby…
$ intake_age    &lt;int&gt; 7, 1, 2, 12, 1, 1, 2, 24, 1, 3, 4, 12, 1, 7, 0, 12, 1, 1…</code></pre>
</div>
</div>
<p>Las variables que nos interesan son color (<code>color</code>), raza (<code>breed</code>), edad a la que entró (<code>intake_age</code>), motivo de la salida (<code>out_event</code>) y días para el evento de salida (<code>days_to_event</code>).</p>
<p>Para el color, dado que hay 204 tipos en la base y para el propósito de nuestro proyecto, los clasificaremos solo en “negro” y “otro”:</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-3_5d2424b4fa62aee40a40fc7a43bda864">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Proporción de gatos negros vs. total.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>AustinCats <span class="ot">&lt;-</span> AustinCats <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pelaje =</span> <span class="fu">ifelse</span>(color <span class="sc">==</span> <span class="st">"Black"</span>, <span class="st">"negro"</span>, <span class="st">"otro"</span>),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">id_pelaje  =</span> <span class="fu">ifelse</span>(color <span class="sc">==</span> <span class="st">"negro"</span>, <span class="dv">1</span>, <span class="dv">2</span>)) </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>color_gatos <span class="ot">&lt;-</span> AustinCats <span class="sc">%&gt;%</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(pelaje) <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">porcentaje =</span> <span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>n<span class="sc">/</span><span class="fu">sum</span>(n)))</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>color_gatos <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> pelaje)) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> porcentaje, <span class="at">fill =</span> pelaje)) <span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> porcentaje, <span class="at">label =</span> <span class="fu">paste0</span>(porcentaje, <span class="st">"%"</span>)), </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"negro"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"otro"</span> <span class="ot">=</span> <span class="st">"antiquewhite4"</span>)) <span class="sc">+</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Porcentaje"</span>, <span class="at">y =</span> <span class="st">"Pelaje"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `&lt;scale&gt;` argument of `guides()` cannot be `FALSE`. Use "none" instead as
of ggplot2 3.3.4.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Proyecto_Final_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>De igual forma, para raza los clasificaremos en “doméstico” si son de la raza <code>Domestic Shorthair Mix</code>, y “otro” para las demás razas.</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-4_f30a3436fcb9ab47654a131da9e1dc18">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Proporción de gatos domésticos de pelaje corto vs. total.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>AustinCats <span class="ot">&lt;-</span> AustinCats <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">raza =</span> <span class="fu">ifelse</span>(breed <span class="sc">==</span> <span class="st">"Domestic Shorthair Mix"</span>, <span class="st">"domestico"</span>, <span class="st">"otro"</span>),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">id_pelaje  =</span> <span class="fu">ifelse</span>(raza <span class="sc">==</span> <span class="st">"domestico"</span>, <span class="dv">1</span>, <span class="dv">2</span>)) </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>raza_gatos <span class="ot">&lt;-</span> AustinCats <span class="sc">%&gt;%</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(raza) <span class="sc">%&gt;%</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">porcentaje =</span> <span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>n<span class="sc">/</span><span class="fu">sum</span>(n)))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>raza_gatos <span class="sc">%&gt;%</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> raza)) <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> porcentaje, <span class="at">fill =</span> raza)) <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> porcentaje, <span class="at">label =</span> <span class="fu">paste0</span>(porcentaje, <span class="st">"%"</span>)), </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"domestico"</span> <span class="ot">=</span> <span class="st">"cyan3"</span>, <span class="st">"otro"</span> <span class="ot">=</span> <span class="st">"blue1"</span>)) <span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Porcentaje"</span>, <span class="at">y =</span> <span class="st">"Raza"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Proyecto_Final_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>El evento de salida, se refiere a la razón por la que los gatos salieron del refugio, en este caso la gran mayoría es adoptado.</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-5_467668e00d3c229e25d53fd42b29b7c3">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conteo por evento de salida</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>AustinCats <span class="sc">%&gt;%</span> <span class="fu">count</span>(out_event)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   out_event     n
1   Adoption 11351
2   Censored   549
3       Died   369
4   Disposal     9
5 Euthanasia   636
6    Missing    28
7   Transfer  9414</code></pre>
</div>
</div>
<p>Siguiendo el tratamiento propuesto por McElreath, crearemos dos variables a partir de la variable de evento de salida: “adoptado”, que será binaria, dependiendo de si fue adoptado o no, y la de “censurado”, igualmente binaria y opuesta a la de “adoptado”.</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-6_b980fd4e1da86a2bdecf509bc0215ca9">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creación de variable adoptado 1:sí, 0:no.</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Creación de variable censurado 0:no adoptado , 1:sí adoptado.</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Creación de variable salida adopción, otro.</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>AustinCats <span class="ot">&lt;-</span> AustinCats <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">adoptado  =</span> <span class="fu">ifelse</span>(out_event <span class="sc">==</span> <span class="st">"Adoption"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">censurado =</span> <span class="fu">ifelse</span>(out_event <span class="sc">!=</span> <span class="st">"Adoption"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>gatos_adoptados <span class="ot">&lt;-</span> AustinCats <span class="sc">%&gt;%</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">salida  =</span> <span class="fu">ifelse</span>(out_event <span class="sc">==</span> <span class="st">"Adoption"</span>, <span class="st">"adopción"</span>, <span class="st">"otro"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(salida) <span class="sc">%&gt;%</span> </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">porcentaje =</span> <span class="dv">100</span><span class="sc">*</span>n<span class="sc">/</span><span class="fu">sum</span>(n))</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Proporción de gatos adoptados vs. otro.</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>gatos_adoptados <span class="sc">%&gt;%</span> </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> salida)) <span class="sc">+</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> porcentaje, <span class="at">fill =</span> <span class="fu">factor</span>(salida))) <span class="sc">+</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"adopción"</span> <span class="ot">=</span> <span class="st">"green3"</span>, <span class="st">"otro"</span> <span class="ot">=</span> <span class="st">"#FF6A6A"</span>)) <span class="sc">+</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Proyecto_Final_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>En los análisis de supervivencia, los <code>datos censurados</code> son aquellos en los que no se conoce el tiempo exacto en que ocurrió el evento de interés, sino que solo se sabe que ocurrió dentro de un cierto periodo de tiempo.</p>
<p>Existen dos tipos principales de censura:</p>
<ol type="1">
<li><p>Censura por la izquierda: Se produce cuando el evento de interés ha tenido lugar antes del punto de inicio del estudio. En este caso, el tiempo de censura será el tiempo de inicio del estudio, ya que no se conoce el tiempo exacto en que ocurrió el evento antes de ese punto.</p></li>
<li><p>Censura por la derecha: Ocurre cuando el estudio se termina en un tiempo fijo predeterminado, y no se ha observado el evento de interés para algunos individuos antes de finalizar el estudio. En este caso, se conoce el tiempo mínimo de supervivencia, pero no el tiempo exacto en que ocurrirá el evento.</p></li>
</ol>
<p>En este caso, tenemos datos censurados únicamente por la derecha. No hay censurados por la izquierda, ya que todos los gatos cuentan con una fecha de entrada al refugio (<code>date_in</code>). Los censurados por la derecha son aquellos que por alguna u otra razón salieron del refugio sin ser adoptados, o que siguen en el refugio esperando ser adoptados.</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-7_c76741ae11a70875526a7dc6a8212db8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Contar el número de valores NA en la columna date_in.</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>date_in_na <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(AustinCats<span class="sc">$</span>date_in))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(date_in_na)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>No podemos ignorar los datos censurados, ya que lo que queremos modelar es el tiempo de espera antes de que un evento ocurra (muerte, adopción, etc.), y si quitamos estos datos tendríamos un error de sesgo. Como se ve en la siguiente gráfica.</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-8_2e9ad3aec5584d490395a64392ef9f89">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribución de la variable days_to_event, agrupado por la variable censurado.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>AustinCats <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">censurado =</span> <span class="fu">factor</span>(censurado)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(days_to_event <span class="sc">&lt;</span> <span class="dv">200</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> days_to_event, <span class="at">y =</span> censurado)) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># let's just mark off the 50% intervals</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> .<span class="dv">5</span>, <span class="at">fill=</span><span class="st">"red"</span>, <span class="at">height =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"censurado == 0"</span>, <span class="st">"censurado == 1"</span>)) <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">5.1</span>)) <span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Proyecto_Final_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>La distribución de la variable, <code>days_to_event,</code> luce muy diferente según si los datos fueron censurados o no. Sin embargo, como ejemplo académico haremos un primer modelo sin datos censurados.</p>
</section>
<section id="modelo-sin-datos-censurados" class="level2">
<h2 class="anchored" data-anchor-id="modelo-sin-datos-censurados">Modelo sin datos censurados</h2>
<section id="modelo-generativo" class="level3">
<h3 class="anchored" data-anchor-id="modelo-generativo">Modelo generativo</h3>
<ul>
<li><p>Sea <span class="math inline">\(C\)</span> el color del pelaje del gato (1 si es negro y 2 en cualquier otro caso).</p></li>
<li><p><span class="math inline">\(U\)</span> las variables no observadas o no tomadas en cuenta para el modelo (si el gato llegó enfermo, sexo, temperamento, etc.).</p></li>
<li><p><span class="math inline">\(A\)</span> es 1 si el gato fue adoptado y 0 en cualquier otro caso.</p></li>
<li><p><span class="math inline">\(D\)</span> son los días que le toma a un gato ser adoptado o salir del refugio.</p></li>
</ul>
<p>Como para este primer modelo <strong>NO</strong> estamos tomando en cuenta los datos censurados, solo tomamos los datos de los gatos que son adoptados.</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-9_61c271f3739550d61a0fc2cd6813f381">
<div class="cell-output-display">
<div id="htmlwidget-7923b15ee3c0c6ba3403" style="width:100%;height:780px;" class="grViz html-widget "></div>
<script type="application/json" data-for="htmlwidget-7923b15ee3c0c6ba3403">{"x":{"diagram":"\ndigraph {\n  graph [ranksep = 0.2, rankdir = LR, bgcolor=ivory2]\n  node [shape=plaintext]\n  U [shape=circle]\n  C\n  D\n  A [fontcolor=red]\n  edge [minlen = 3]\n  U -> A\n  U -> D\n  C -> D\n  C -> A\n  A -> D\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-10_79a09c443ba7834b4bff5bc5963202a2">
<div class="cell-output-display">
<div id="htmlwidget-23573161afea3572c0d4" style="width:100%;height:780px;" class="grViz html-widget "></div>
<script type="application/json" data-for="htmlwidget-23573161afea3572c0d4">{"x":{"diagram":"\ndigraph {\n  graph [ranksep = 0.2, rankdir = LR, bgcolor=ivory2]\n  node [shape=plaintext]\n  U [shape=circle]\n  C\n  D\n  A [fontcolor=red]\n  edge [minlen = 3]\n  U -> A\n  C -> A\n  A -> D\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-11_18ba9a92c42742641851a593cc14a588">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#yo digo que el segundo es el bueno</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-12_bf63ee2232387d5a7043320235f0c309">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">dagitty</span>( <span class="st">"dag {     U -&gt; A     C -&gt; A     A -&gt; D }"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">impliedConditionalIndependencies</span>(g1, <span class="at">type =</span> <span class="st">"all.pairs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C _||_ D | A
C _||_ D | A, U
C _||_ U
D _||_ U | A
D _||_ U | A, C</code></pre>
</div>
</div>
<p>Es fácil observar que es una mala idea controlar por <span class="math inline">\(A\)</span>, ya que estaríamos bloqueando justo el efecto que queremos modelar, esto es, si el color negro del gato afecta su tiempo para ser adoptado.</p>
<p>Podemos modelar las adopciones sí observadas (no censuradas) como una probabilidad de que un evento ocurra, esto es:</p>
<p><span class="math display">\[D_i\sim\exp(\lambda_i)\]</span> <span class="math display">\[p(D_i|\lambda_i)=\lambda_i\exp(-\lambda_iD_i)\]</span></p>
<p>La distribución exponencial es adecuada para eventos donde el tiempos entre ellos ocurren de manera continua y aleatoria, como las adopciones de gatos. Se define un parámetro <span class="math inline">\(\lambda\)</span>, probabilidad constante de cada día de ser adoptados. Después de cierto periodo, n número de gatos habrán sido adoptados, y conforme pasa el tiempo menos gatos estarán en espera de ser adoptados (decaimiento exponencial). La distribución exponencial distribuye nuestra incertidumbre de manera uniforme sobre el tiempo.</p>
<p>En nuestro caso, para las adopciones observadas <span class="math inline">\(p(D_i|\lambda_i)\)</span> representa la probabilidad de ser adoptado en “x” día.</p>
<p>Antes de usar los datos reales, hacemos una prueba con datos simulados y nuestras suposiciones. La siguiente función simula una muestra de N gatos y regresa el tiempo para ser adoptados:</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-13_551f32eca77d69b51a570c4fe7360a3a">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>sim_gatos_1 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">lambda_negro =</span> <span class="fl">0.02</span>, <span class="at">lambda_otro =</span> <span class="fl">0.04</span>, <span class="at">N =</span> <span class="dv">1000</span>, <span class="at">p=</span><span class="fl">0.15</span>) {</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  num_gatos_negros <span class="ot">&lt;-</span> <span class="fu">round</span>(N<span class="sc">*</span>p)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  num_otros_gatos <span class="ot">&lt;-</span> N <span class="sc">-</span> num_gatos_negros</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  black_days <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rexp</span>(num_gatos_negros, lambda_negro))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  other_days <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rexp</span>(num_otros_gatos, lambda_otro))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  censored <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, N)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>( <span class="at">days_to_adoption =</span> <span class="fu">c</span>(black_days, other_days),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">color_id=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,num_gatos_negros),<span class="fu">rep</span>(<span class="dv">2</span>,num_otros_gatos)),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>          censored</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Podemos hacer pruebas al modelo generativo en casos extremos:</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-14_e6af64e09e54392a4dedd1846bf69f3d">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(1234)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_gatos_1</span>(<span class="at">p=</span><span class="fl">1.0</span>, <span class="at">N=</span><span class="dv">10</span>) <span class="co"># puros gatos negros.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   days_to_adoption color_id censored
              &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1               89        1        0
 2               29        1        0
 3               41        1        0
 4                1        1        0
 5               78        1        0
 6               74        1        0
 7               24        1        0
 8               57        1        0
 9                2        1        0
10               25        1        0</code></pre>
</div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-15_0cbc5f22dd07e41c99cfba227367b561">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_gatos_1</span>(<span class="at">p=</span><span class="fl">0.0</span>, <span class="at">N=</span><span class="dv">10</span>) <span class="co"># ningún gato negro.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   days_to_adoption color_id censored
              &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1               24        2        0
 2                4        2        0
 3               27        2        0
 4               14        2        0
 5               37        2        0
 6               17        2        0
 7                9        2        0
 8               32        2        0
 9                8        2        0
10              109        2        0</code></pre>
</div>
</div>
<p>Y también revisamos nuestro modelo generativo con el conocimiento de área, en este caso usamos la curva de supervivencia Kaplan-Meier:</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-16_f148f9c9caa05dd9a3eef8dd36eddbf9">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">sim_gatos_1</span>(<span class="at">N=</span><span class="dv">100</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos ordenados por days_to_adoption, para cada grupo.</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(color_id, days_to_adoption)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir color_id a factor para los gráficos.</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>color_id <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data<span class="sc">$</span>color_id)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>calculate_km <span class="ot">&lt;-</span> <span class="cf">function</span>(time, status) {</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(time)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  survival <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">-</span> status <span class="sc">/</span> (n<span class="sc">:</span><span class="dv">1</span>))</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">time =</span> time, <span class="at">survival =</span> survival)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Kaplan-Meier para cada grupo.</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>km_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(color_id) <span class="sc">%&gt;%</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(days_to_adoption) <span class="sc">%&gt;%</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">event =</span> <span class="dv">1</span> <span class="sc">-</span> censored) <span class="sc">%&gt;%</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">risk_set =</span> <span class="fu">rev</span>(<span class="fu">cumsum</span>(<span class="fu">rev</span>(event)))) <span class="sc">%&gt;%</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="sc">~</span> <span class="fu">calculate_km</span>(.x<span class="sc">$</span>days_to_adoption, .x<span class="sc">$</span>event)) <span class="sc">%&gt;%</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>km_plot_data <span class="ot">&lt;-</span> km_data <span class="sc">%&gt;%</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(time, survival, color_id) <span class="sc">%&gt;%</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfica de curva de supervivencia Kaplan-Meier.</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(km_plot_data, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> survival, <span class="at">color =</span> color_id)) <span class="sc">+</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>() <span class="sc">+</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Curva de Supervivencia de Kaplan-Meier"</span>, <span class="at">x =</span> <span class="st">"Tiempo"</span>,</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Probabilidad de Supervivencia"</span>) <span class="sc">+</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"ivory2"</span>), </span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"ivory2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Proyecto_Final_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>El modelo de Kaplan-Meier se basa en la estimación de las probabilidades condicionales en cada punto temporal cuando tiene lugar un evento y en tomar el límite del producto de esas probabilidades para estimar la tasa de supervivencia en cada punto temporal.</p>
<p>En esta gráfica podemos ver que, un poco antes de los 50 días, la población de gatos negros (1) aún en espera de ser adoptados es superior a los otros gatos (2).</p>
<p>Finalmente, podemos simular de la <em>a priori</em> cuáles son las posibilidades que estamos considerando.</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-17_7a2d6e212542f8dd3ab5328dafba5d3b">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>sim_gatos_mod_1 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">N =</span> <span class="dv">1000</span>, <span class="at">p=</span><span class="fl">0.15</span>) {</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print(alpha)</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  lambda_negro <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">exp</span>(alpha[<span class="dv">1</span>])</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  lambda_otro <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">exp</span>(alpha[<span class="dv">2</span>])</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print(lambda_negro)</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  num_gatos_negros <span class="ot">&lt;-</span> <span class="fu">round</span>(N<span class="sc">*</span>p)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  num_otros_gatos <span class="ot">&lt;-</span> N <span class="sc">-</span> num_gatos_negros</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  negro_dias <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rexp</span>(num_gatos_negros, lambda_negro))</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  otro_dias <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rexp</span>(num_otros_gatos, lambda_otro))</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  censored <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, N)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">days_to_adoption =</span> <span class="fu">c</span>(negro_dias, otro_dias),</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">color_id=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,num_gatos_negros),<span class="fu">rep</span>(<span class="dv">2</span>,num_otros_gatos)),</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>            censored</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hacemos replicaciones:</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-18_9dcb79fc11de9619e57a4460b4b8e95c">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>sims_tbl <span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="cf">function</span>(rep){</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sim_gatos_mod_1</span>(<span class="at">N=</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">rep =</span> rep)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a> })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nuestros supuestos actuales se ven así.</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-19_1122f99151a49b3a001177392732b3c3">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>sims_tbl <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(rep, color_id, days_to_adoption) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_id =</span> <span class="fu">as.factor</span>(color_id)) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(rep, color_id) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(days_to_adoption) <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">event =</span> <span class="dv">1</span> <span class="sc">-</span> censored) <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">risk_set =</span> <span class="fu">rev</span>(<span class="fu">cumsum</span>(<span class="fu">rev</span>(event)))) <span class="sc">%&gt;%</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="sc">~</span> <span class="fu">calculate_km</span>(.x<span class="sc">$</span>days_to_adoption, .x<span class="sc">$</span>event)) <span class="sc">%&gt;%</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(time, survival, color_id, rep) <span class="sc">%&gt;%</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> survival, <span class="at">color =</span> color_id)) <span class="sc">+</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>() <span class="sc">+</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Curva de Supervivencia de Kaplan-Meier"</span>, <span class="at">x =</span> <span class="st">"Tiempo"</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Probabilidad de Supervivencia"</span>) <span class="sc">+</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">200</span>)) <span class="sc">+</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>rep) <span class="sc">+</span> </span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"ivory2"</span>), </span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"ivory2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Proyecto_Final_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Aunque hay algunas un poco extremas, la mayoría luce razonable.</p>
</section>
<section id="cantidad-a-estimar" class="level3">
<h3 class="anchored" data-anchor-id="cantidad-a-estimar">Cantidad a estimar</h3>
<p>Queremos estimar el número de días <span class="math inline">\(D\)</span> que le toma a un gato esperar para ser adoptado, pero, como lo mencionamos arriba, tomaremos solo los gatos que <strong>sí</strong> fueron adoptados en la ventana de tiempo, esto es:</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-20_b9df191b45734f296f3e5ccb74805fd2">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>AustinCats_model_1 <span class="ot">&lt;-</span> AustinCats <span class="sc">%&gt;%</span> <span class="fu">filter</span>(adoptado <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(AustinCats_model_1)<span class="sc">/</span><span class="fu">nrow</span>(AustinCats)<span class="sc">*</span><span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 50.77384</code></pre>
</div>
</div>
<p>Trabajaremos con solo el 50% de las observaciones de la base original de <em><code>AustinCats</code></em>.</p>
</section>
<section id="proceso-estadístico" class="level3">
<h3 class="anchored" data-anchor-id="proceso-estadístico">Proceso estadístico</h3>
<p>Como estamos controlando por <span class="math inline">\(A_i=1\)</span>, nuestro objetivo es calcular o aproximar la cantidad:</p>
<p><span class="math display">\[p(D_i | A_i = 1)\]</span></p>
<p><span class="math display">\[D_i | A_i = 1 \sim \exp(\lambda_i)\]</span> con: <span class="math display">\[\lambda_i = 1/\mu_i\]</span> <span class="math display">\[log \mu_i = \alpha_{Color_i}\]</span> <span class="math display">\[\alpha_{Color} \sim N(0,1)\]</span></p>
</section>
<section id="pruebas-del-proceso-estadístico" class="level3">
<h3 class="anchored" data-anchor-id="pruebas-del-proceso-estadístico">Pruebas del proceso estadístico</h3>
<p>El modelo en stan se puede escribir como sigue:</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-21_14dcf89fe795768af027c483bcb65b3b">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#days_to_event con event= adopcion</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>model_string <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0&gt; N;  // Número total de obs.</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=1,upper=2&gt; color_id[N];  // Índice de color de pelaje para cada obs.</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="st">  vector&lt;lower=0&gt;[N] days_to_event;  // Días hasta el evento (adopción)</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[2] alpha;  // Intercepto para cada categoría de color de pelaje</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] lambda;  // Tasa de adopción para cada observación</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="st">  alpha ~ normal(0, 1);  // Prior para los interceptos: Normal(0,1)</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="st">  for (i in 1:N) {</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="st">    lambda[i] = exp(-alpha[color_id[i]]);  </span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="st">    // Tasa de adopción para cada observación, basada en el intercepto </span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="st">    // correspondiente al color de pelaje</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="st">  days_to_event ~ exponential(lambda);  </span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="st">  // Distribución exponencial para los días hasta el evento, con tasa lambda</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-22_3b463e1e5ebe2243974eec2111b9b7d1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>stan_model <span class="ot">&lt;-</span> <span class="fu">stan_model</span>(<span class="at">model_code =</span> model_string, <span class="at">model_name =</span> <span class="st">"modelo_gatos"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Utilizaremos una muestra simulada de 1000 gatos de nuestro proceso generador de datos para hacerle pruebas <em>a piori</em> a nuestro modelo.</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-23_8053dc010e2586a6f71ae19167153def">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>gatos_prueba <span class="ot">&lt;-</span> <span class="fu">sim_gatos_1</span>(<span class="at">lambda_negro =</span> <span class="fl">0.02</span>, <span class="at">lambda_otro =</span> <span class="fl">0.04</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-24_c9fe06b96bde01130cf841407267b709">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>data_list <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">nrow</span>(gatos_prueba),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">days_to_event =</span> <span class="fu">as.numeric</span>(gatos_prueba<span class="sc">$</span>days_to_adoption),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">color_id =</span> gatos_prueba<span class="sc">$</span>color_id</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-25_1b2d7d27a33974ad7a76129d4e54e0c8">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>stan_fit <span class="ot">&lt;-</span> <span class="fu">sampling</span>(stan_model, <span class="at">data =</span> data_list, <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">thin =</span> <span class="dv">2</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.95</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'modelo_gatos' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 7e-05 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.7 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 0.145 seconds (Warm-up)
Chain 1:                0.136 seconds (Sampling)
Chain 1:                0.281 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'modelo_gatos' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 2.3e-05 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.23 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 2: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 0.133 seconds (Warm-up)
Chain 2:                0.132 seconds (Sampling)
Chain 2:                0.265 seconds (Total)
Chain 2: 

SAMPLING FOR MODEL 'modelo_gatos' NOW (CHAIN 3).
Chain 3: 
Chain 3: Gradient evaluation took 2.3e-05 seconds
Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.23 seconds.
Chain 3: Adjust your expectations accordingly!
Chain 3: 
Chain 3: 
Chain 3: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 3: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 3: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 3: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 3: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 3: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 3: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 3: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 3: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 3: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 3: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 3: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 3: 
Chain 3:  Elapsed Time: 0.143 seconds (Warm-up)
Chain 3:                0.127 seconds (Sampling)
Chain 3:                0.27 seconds (Total)
Chain 3: </code></pre>
</div>
</div>
<p>Finalmente podemos recuperar las lambdas:</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-26_7a1cf67a060856a0f43249ac8d001704">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(stan_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Inference for Stan model: modelo_gatos.
3 chains, each with iter=2000; warmup=1000; thin=2; 
post-warmup draws per chain=500, total post-warmup draws=1500.

             mean se_mean   sd     2.5%      25%      50%      75%    97.5%
alpha[1]     3.89    0.00 0.08     3.74     3.84     3.89     3.94     4.06
alpha[2]     3.25    0.00 0.03     3.18     3.23     3.25     3.27     3.32
lp__     -4365.43    0.03 1.09 -4368.44 -4365.82 -4365.10 -4364.68 -4364.45
         n_eff Rhat
alpha[1]  1303    1
alpha[2]  1249    1
lp__      1100    1

Samples were drawn using NUTS(diag_e) at Sun May 26 03:19:47 2024.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
</div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-27_2d30dd88af1bba3b95c174f4125e50a3">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span><span class="fl">3.89</span>) <span class="co"># gatos negros </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02044535</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span><span class="fl">3.25</span>) <span class="co"># otros gatos</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.03877421</code></pre>
</div>
</div>
</section>
<section id="analizar-datos-y-resumir-resultados" class="level3">
<h3 class="anchored" data-anchor-id="analizar-datos-y-resumir-resultados">Analizar datos y resumir resultados</h3>
<p>Ahora que terminamos de revisar nuestros supuestos <em>a priori y a posterior,</em> utilizaremos los datos observados de adopciones en nuestra base de datos filtrada.</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-28_3f890e1b2093101c38149d2aec492caa">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pasamos los datos observados a ser evaluados en nuestro modelo</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>data_list <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">nrow</span>(AustinCats_model_1),</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">days_to_event =</span> <span class="fu">as.numeric</span>(AustinCats_model_1<span class="sc">$</span>days_to_event),</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">color_id =</span> AustinCats_model_1<span class="sc">$</span>id_pelaje</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-29_8514317dc68e99d980ca316be52d01b1">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos parámetros de la simulación de nuestro modelo</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>stan_fit <span class="ot">&lt;-</span> <span class="fu">sampling</span>(stan_model, <span class="at">data =</span> data_list, <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">thin =</span> <span class="dv">2</span>,<span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.95</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'modelo_gatos' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.000407 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 4.07 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 1.56 seconds (Warm-up)
Chain 1:                1.538 seconds (Sampling)
Chain 1:                3.098 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'modelo_gatos' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.000287 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 2.87 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 2: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 1.633 seconds (Warm-up)
Chain 2:                1.568 seconds (Sampling)
Chain 2:                3.201 seconds (Total)
Chain 2: 

SAMPLING FOR MODEL 'modelo_gatos' NOW (CHAIN 3).
Chain 3: 
Chain 3: Gradient evaluation took 0.000263 seconds
Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 2.63 seconds.
Chain 3: Adjust your expectations accordingly!
Chain 3: 
Chain 3: 
Chain 3: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 3: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 3: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 3: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 3: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 3: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 3: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 3: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 3: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 3: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 3: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 3: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 3: 
Chain 3:  Elapsed Time: 1.732 seconds (Warm-up)
Chain 3:                1.666 seconds (Sampling)
Chain 3:                3.398 seconds (Total)
Chain 3: </code></pre>
</div>
</div>
</section>
<section id="revisar-cómputos-y-resultado-del-modelo" class="level3">
<h3 class="anchored" data-anchor-id="revisar-cómputos-y-resultado-del-modelo">Revisar cómputos y resultado del modelo</h3>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-30_cce67c026e87842e4755b090cafabb28">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Resultados del modelo</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(stan_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Inference for Stan model: modelo_gatos.
3 chains, each with iter=2000; warmup=1000; thin=2; 
post-warmup draws per chain=500, total post-warmup draws=1500.

              mean se_mean   sd      2.5%       25%       50%       75%
alpha[1]      3.67    0.00 0.01      3.65      3.66      3.67      3.67
alpha[2]      3.58    0.00 0.02      3.54      3.57      3.58      3.59
lp__     -52767.32    0.03 1.04 -52770.15 -52767.73 -52766.96 -52766.57
             97.5% n_eff Rhat
alpha[1]      3.69  1350    1
alpha[2]      3.62  1372    1
lp__     -52766.33  1076    1

Samples were drawn using NUTS(diag_e) at Sun May 26 03:19:57 2024.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
</div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-31_fb36b61d98fb408eab65520e02c12ee0">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>alpha_samples <span class="ot">&lt;-</span>  rstan<span class="sc">::</span><span class="fu">extract</span>(stan_fit, <span class="at">pars =</span> <span class="st">"alpha"</span>)<span class="sc">$</span>alpha</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-32_710f090f625cc63da0b4bedb469c670b">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># falta, revisar error, corria bien</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co">#traceplot(stan_fit, pars = "alpha") +</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  theme(panel.background = element_rect(fill = "ivory2"), </span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">#        plot.background = element_rect(fill = "ivory2"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Las cadenas se mezclan correctamente y tenemos tamaños de muestra efectivos y Rhat buenos.</p>
<p>Inferencia a partir de la distribución <em>a posteriori</em> de alpha, calculamos intervalos de credibilidad para evaluar la plausibilidad de los valores de los interceptos para cada categoría de color de pelaje, dada la evidencia de los datos.</p>
<p>Los intervalos de credibilidad para cada elemento de alpha nos permitirán determinar si existe evidencia estadísticamente significativa de que el color del pelaje influye en el tiempo de adopción.</p>
<p>Si los intervalos de credibilidad para las diferentes categorías de color no se superponen significativamente, esto sugeriría que hay una diferencia en los tiempos de adopción entre los gatos de diferentes colores.</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-33_0a23eb238dc22a9644f1f226b4e5dc69">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Graficamos distribuciones posteriores de alpha</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>alpha_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(alpha_samples)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(alpha_df) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"alpha["</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(alpha_df), <span class="st">"]"</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>alpha_long <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">gather</span>(alpha_df, <span class="at">key =</span> <span class="st">"parameter"</span>, <span class="at">value =</span> <span class="st">"value"</span>)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(alpha_long, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> parameter)) <span class="sc">+</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Alpha"</span>) <span class="sc">+</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Densidad"</span>) <span class="sc">+</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distribuciones Posteriores de Alfa"</span>) <span class="sc">+</span> </span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"ivory2"</span>), </span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"ivory2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Proyecto_Final_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Intervalos de credibilidad:</p>
<p>El intervalo de credibilidad del 95% para alpha[1] (gatos negros) es [3.65, 3.69].</p>
<p>El intervalo de credibilidad del 95% para alpha[2] (otros colores) es [3.54, 3.62].</p>
<p>Estos intervalos no se superponen, lo que sugiere que hay una diferencia significativa en los tiempos de adopción entre los gatos negros y los gatos de otros colores.</p>
<p>Medias posteriores:</p>
<p>La media posterior de alpha[1] (gatos negros) es 3.67.</p>
<p>La media posterior de alpha[2] (otros colores) es 3.58.</p>
<p>Observaciones</p>
<p>Es crucial reconocer que este modelo ignora los datos censurados (gatos no adoptados), que, como mencionamos anteriormente, podrían introducir sesgo en las estimaciones. Los gatos no adoptados podrían tener características distintas a los adoptados.</p>
<p>Por lo tanto, aunque el Modelo 2 ofrece información valiosa, sus resultados deben interpretarse con precaución y complementarse con los del Modelo 1, que incorpora los datos censurados para un análisis más completo.</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-34_bfc8f5d2fb27ac451f2e93bf474c3f6f">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>lambda_black <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">3.67</span>)  <span class="co"># Tasa de adopción para gatos negros</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>lambda_other <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">3.58</span>)  <span class="co"># Tasa de adopción para gatos de otros colores</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>calc_cdf_ccdf <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda, t) {</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  cdf <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>lambda <span class="sc">*</span> t)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  ccdf <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>lambda <span class="sc">*</span> t)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">t =</span> t, <span class="at">cdf =</span> cdf, <span class="at">ccdf =</span> ccdf))</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="at">length.out =</span> <span class="dv">1000</span>)  <span class="co"># Rango de tiempo (0 a 100 días)</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>cdf_ccdf_black <span class="ot">&lt;-</span> <span class="fu">calc_cdf_ccdf</span>(lambda_black, t)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>cdf_ccdf_other <span class="ot">&lt;-</span> <span class="fu">calc_cdf_ccdf</span>(lambda_other, t)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico CDF</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>cdf_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> cdf_ccdf_black, <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> cdf, <span class="at">color =</span> <span class="st">"Black"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> cdf_ccdf_other, <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> cdf, <span class="at">color =</span> <span class="st">"Other"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Tiempo (días)"</span>, <span class="at">y =</span> <span class="st">"Probabilidad Acumulada"</span>,</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"CDF de Tiempo de adopción"</span>) <span class="sc">+</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Color Pelaje"</span>,</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Black"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"Other"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"ivory2"</span>), </span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"ivory2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico CCDF</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>ccdf_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> cdf_ccdf_black, <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> ccdf, <span class="at">color =</span> <span class="st">"Black"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> cdf_ccdf_other, <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> ccdf, <span class="at">color =</span> <span class="st">"Other"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Tiempo (días)"</span>, <span class="at">y =</span> <span class="st">"Probabilidad Acumulada Complementaria"</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"CCDF de Tiempo de adopción"</span>) <span class="sc">+</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Color Pelaje"</span>,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Black"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"Other"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"ivory2"</span>), </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"ivory2"</span>))</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar los gráficos</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cdf_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Proyecto_Final_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ccdf_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Proyecto_Final_files/figure-html/unnamed-chunk-34-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>La curva CDF muestra la probabilidad acumulada de que un gato sea adoptado antes o en un tiempo determinado. La curva CCDF muestra la probabilidad acumulada complementaria, es decir, la probabilidad de que un gato no sea adoptado antes o en un tiempo determinado.</p>
</section>
</section>
<section id="modelo-con-datos-censurados" class="level2">
<h2 class="anchored" data-anchor-id="modelo-con-datos-censurados">Modelo con datos censurados</h2>
<section id="modelo-generativo-1" class="level3">
<h3 class="anchored" data-anchor-id="modelo-generativo-1">Modelo generativo</h3>
<p>Para este caso tenemos el mismo modelo, solo que esta vez no vamos a controlar por la variable <span class="math inline">\(A\)</span>.</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-35_6cfe2e7a7bc6eae8437581b7e85ed0a6">
<div class="cell-output-display">
<div id="htmlwidget-22329c5b7e36a9b3b74c" style="width:100%;height:780px;" class="grViz html-widget "></div>
<script type="application/json" data-for="htmlwidget-22329c5b7e36a9b3b74c">{"x":{"diagram":"\ndigraph {\n  graph [ranksep = 0.2, rankdir = LR, bgcolor=ivory2]\n  node [shape=plaintext]\n  U [shape=circle]\n  C\n  D\n  A\n  edge [minlen = 3]\n  U -> A\n  C -> A\n  A -> D\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-36_8a38f3ef263f6202292b7cbe33aff88b">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">dagitty</span>( <span class="st">"dag {     U -&gt; A     C -&gt; A     A -&gt; D }"</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">impliedConditionalIndependencies</span>(g1, <span class="at">type =</span> <span class="st">"all.pairs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C _||_ D | A
C _||_ D | A, U
C _||_ U
D _||_ U | A
D _||_ U | A, C</code></pre>
</div>
</div>
<p>Para las adopciones sí observadas (no censuradas) usamos el mismo modelo:</p>
<p><span class="math display">\[D_i\sim\exp(\lambda_i)\]</span> <span class="math display">\[p(D_i|\lambda_i)=\lambda_i\exp(-\lambda_iD_i)\]</span>Y para los datos censurados usamos la distribución de probabilidad acumulada complementaria (CCDF): probabilidad de que el evento NO haya ocurrido antes o en el tiempo <span class="math inline">\(x\)</span>.</p>
<p>Al igual que lo hicimos en el caso sin censura, antes de usar los datos reales, hacemos una prueba con datos simulados y nuestras suposiciones. La siguiente función simula una muestra de N gatos y regresa el tiempo para ser adoptados:</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-37_1c31c71f9d46d0eb7ebbdfc4a6183931">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>sim_gatos_2 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">lambda_negro =</span> <span class="fl">0.02</span>, <span class="at">lambda_otro =</span> <span class="fl">0.04</span>, <span class="at">N =</span> <span class="dv">1000</span>, <span class="at">p=</span><span class="fl">0.15</span>) {</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  num_gatos_negros <span class="ot">&lt;-</span> <span class="fu">round</span>(N<span class="sc">*</span>p)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  num_otros_gatos <span class="ot">&lt;-</span> N <span class="sc">-</span> num_gatos_negros</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  black_days <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rexp</span>(num_gatos_negros, lambda_negro))</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  other_days <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rexp</span>(num_otros_gatos, lambda_otro))</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  days_to_event <span class="ot">=</span> <span class="fu">c</span>(black_days, other_days)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simular datos NO censurados</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  adoptado <span class="ot">=</span> <span class="fu">if_else</span>(days_to_event <span class="sc">&gt;=</span> <span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>( <span class="at">days_to_adoption =</span> <span class="fu">c</span>(black_days, other_days),</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">color_id=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,num_gatos_negros),<span class="fu">rep</span>(<span class="dv">2</span>,num_otros_gatos)),</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>          adoptado</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Podemos hacer pruebas al modelo generativo en casos extremos:</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-38_08c1bd866fa50d1f5c9fc7ccdeccc8df">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(1234)</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_gatos_2</span>(<span class="at">p=</span><span class="fl">1.0</span>, <span class="at">N=</span><span class="dv">10</span>) <span class="co"># puros gatos negros.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   days_to_adoption color_id adoptado
              &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1              140        1        0
 2                1        1        1
 3               10        1        1
 4                7        1        1
 5               48        1        1
 6               54        1        1
 7                3        1        1
 8               44        1        1
 9               82        1        1
10              107        1        0</code></pre>
</div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-39_9ec2e5059fb47cd0ac8cec107405a987">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_gatos_2</span>(<span class="at">p=</span><span class="fl">0.0</span>, <span class="at">N=</span><span class="dv">10</span>) <span class="co"># ningún gato negro.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   days_to_adoption color_id adoptado
              &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1                7        2        1
 2                5        2        1
 3                8        2        1
 4               23        2        1
 5               96        2        1
 6               31        2        1
 7               18        2        1
 8                2        2        1
 9                8        2        1
10               22        2        1</code></pre>
</div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-40_6b6a1eed77605cdfaad3c1e6e69aabe2">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">sim_gatos_2</span>(<span class="at">N=</span><span class="dv">1000</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(color_id, days_to_adoption)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir color_id a factor para los gráficos.</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>color_id <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data<span class="sc">$</span>color_id)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>calculate_km <span class="ot">&lt;-</span> <span class="cf">function</span>(time, status) {</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(time)</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  survival <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">-</span> status <span class="sc">/</span> (n<span class="sc">:</span><span class="dv">1</span>))</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">time =</span> time, <span class="at">survival =</span> survival)</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Kaplan-Meier para cada grupo.</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>km_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(color_id) <span class="sc">%&gt;%</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(days_to_adoption) <span class="sc">%&gt;%</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">event =</span> <span class="dv">1</span> <span class="sc">-</span> adoptado) <span class="sc">%&gt;%</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">risk_set =</span> <span class="fu">rev</span>(<span class="fu">cumsum</span>(<span class="fu">rev</span>(event)))) <span class="sc">%&gt;%</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="sc">~</span> <span class="fu">calculate_km</span>(.x<span class="sc">$</span>days_to_adoption, .x<span class="sc">$</span>event)) <span class="sc">%&gt;%</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>km_plot_data <span class="ot">&lt;-</span> km_data <span class="sc">%&gt;%</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(time, survival, color_id) <span class="sc">%&gt;%</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfica de curva de supervivencia Kaplan-Meier.</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(km_plot_data, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> survival, <span class="at">color =</span> color_id)) <span class="sc">+</span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>() <span class="sc">+</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Curva de Supervivencia de Kaplan-Meier"</span>, <span class="at">x =</span> <span class="st">"Tiempo"</span>, <span class="at">y =</span> <span class="st">"Probabilidad de Supervivencia"</span>) <span class="sc">+</span></span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"ivory2"</span>), </span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"ivory2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Proyecto_Final_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>En esta gráfica podemos ver que, un poco antes de los 100 días, la población de gatos negros (1) aún en espera de ser adoptados es superior a los otros gatos (2).</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-41_26d63e2552b84df32bd1dabce3926c7b">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>sim_gatos_2 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">N =</span> <span class="dv">1000</span>, <span class="at">p=</span><span class="fl">0.15</span>) {</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  lambda_negro <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">exp</span>(alpha[<span class="dv">1</span>])</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  lambda_otro <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">exp</span>(alpha[<span class="dv">2</span>])</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  num_gatos_negros <span class="ot">&lt;-</span> <span class="fu">round</span>(N<span class="sc">*</span>p)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  num_otros_gatos <span class="ot">&lt;-</span> N <span class="sc">-</span> num_gatos_negros</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  black_days <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rexp</span>(num_gatos_negros, lambda_negro))</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  other_days <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rexp</span>(num_otros_gatos, lambda_otro))</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  days_to_event <span class="ot">=</span> <span class="fu">c</span>(black_days, other_days)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simular datos NO censurados</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  adoptado <span class="ot">=</span> <span class="fu">if_else</span>(days_to_event <span class="sc">&gt;=</span> <span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>( <span class="at">days_to_adoption =</span> <span class="fu">c</span>(black_days, other_days),</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">color_id=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,num_gatos_negros),<span class="fu">rep</span>(<span class="dv">2</span>,num_otros_gatos)),</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>          adoptado</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hacemos replicaciones:</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-42_8120890db4b3cbefa42e5608feaa0ae8">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>sims_tbl <span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="cf">function</span>(rep){</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sim_gatos_2</span>(<span class="at">N=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">rep =</span> rep)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a> })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nuestros supuestos actuales se ven así.</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-43_d203368abbe7eb854a4acdc8bbca9669">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>sims_tbl <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(rep, color_id, days_to_adoption) <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_id =</span> <span class="fu">as.factor</span>(color_id)) <span class="sc">%&gt;%</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(rep, color_id) <span class="sc">%&gt;%</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(days_to_adoption) <span class="sc">%&gt;%</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">event =</span> <span class="dv">1</span> <span class="sc">-</span> adoptado) <span class="sc">%&gt;%</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">risk_set =</span> <span class="fu">rev</span>(<span class="fu">cumsum</span>(<span class="fu">rev</span>(event)))) <span class="sc">%&gt;%</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="sc">~</span> <span class="fu">calculate_km</span>(.x<span class="sc">$</span>days_to_adoption, .x<span class="sc">$</span>event)) <span class="sc">%&gt;%</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(time, survival, color_id, rep) <span class="sc">%&gt;%</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> survival, <span class="at">color =</span> color_id)) <span class="sc">+</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>() <span class="sc">+</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Curva de Supervivencia de Kaplan-Meier"</span>, <span class="at">x =</span> <span class="st">"Tiempo"</span>,</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Probabilidad de Supervivencia"</span>) <span class="sc">+</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">200</span>)) <span class="sc">+</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>rep) <span class="sc">+</span> </span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"ivory2"</span>), </span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"ivory2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 14 rows containing missing values or values outside the scale range
(`geom_step()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Proyecto_Final_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="cantidad-a-estimar-1" class="level3">
<h3 class="anchored" data-anchor-id="cantidad-a-estimar-1">Cantidad a estimar</h3>
<p>Nuestro objetivo sigue siendo estimar el número de días <span class="math inline">\(D\)</span> que le toma a un gato esperar para ser adoptado, esta vez utilizaremos tanto los datos censurados como no censurados.</p>
</section>
<section id="proceso-estadístico-1" class="level3">
<h3 class="anchored" data-anchor-id="proceso-estadístico-1">Proceso estadístico</h3>
<p><span class="math display">\[f(y)=\lambda e^{\lambda y}\]</span></p>
<p><span class="math display">\[E[y]=\frac{1}{\lambda}\]</span></p>
<p><span class="math display">\[D_i | A_i = 1 \sim \exp(\lambda_i)\]</span> <span class="math display">\[D_i | A_i = 0 \sim \exp CCDF(\lambda_i)\]</span></p>
<p><span class="math display">\[\lambda_i = 1/\mu_i\]</span></p>
<p><span class="math display">\[log \mu_i = \alpha_{Color_i}\]</span> <span class="math display">\[\alpha_{Color} \sim N(0,1)\]</span></p>
<ul>
<li><p><span class="math inline">\(D_i | A_i = 1\)</span> - adopciones observadas</p></li>
<li><p><span class="math inline">\(D_i | A_i = 1\)</span> - adopciones aun no observadas</p></li>
<li><p><span class="math inline">\(\alpha_{\text{cat color}[i]}\)</span> - <span class="math inline">\(log\mu\)</span> tiempo de adopción para cada color</p></li>
<li><p><span class="math inline">\(\log \mu_i\)</span> - función liga para garantizar <span class="math inline">\(\alpha\)</span> positivos</p></li>
<li><p><span class="math inline">\(\lambda_i = \frac{1}{\mu_i}\)</span> tiempo promedio adopción</p></li>
</ul>
</section>
<section id="pruebas-del-proceso-estadístico-1" class="level3">
<h3 class="anchored" data-anchor-id="pruebas-del-proceso-estadístico-1">Pruebas del proceso estadístico</h3>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-44_70db459164d6f1e8bb76b143ebdeb92b">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>modelo <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="st">"modelo.stan"</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(modelo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>data{
int N;
// array[N] int adopted;
vector[N] days_to_event;
array[N] int color_id;
}

parameters{
vector&lt;lower=0&gt;[2] alpha;
}

transformed parameters{
vector&lt;lower=0&gt;[N] lambda;
vector[N] mu;
  for ( i in 1:N ) {
    mu[i] = exp(alpha[color_id[i]]);
    lambda[i] = 1/mu[i];
  }
}

model{
alpha ~ normal(3, 1);
  // for (i in 1:N)
  //   if (adopted[i] == 0) target += exponential_lccdf(days_to_event[i] | lambda[i]);
  for (i in 1:N)
    days_to_event[i] ~ exponential(lambda[i]);
}

generated quantities{
vector[N] pred;
  for (i in 1:N)
    pred[i] = exponential_rng(lambda[i]);
}</code></pre>
</div>
</div>
</section>
<section id="checar-cómputos-y-resultado-del-modelo" class="level3">
<h3 class="anchored" data-anchor-id="checar-cómputos-y-resultado-del-modelo">Checar cómputos y resultado del modelo</h3>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-45_167088b635aef20a9dbb65d50401ddb5">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>black<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">rexp</span>(<span class="dv">1000</span>,<span class="fl">0.02</span>))</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>other<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">rexp</span>(<span class="dv">1000</span>,<span class="fl">0.03</span>))</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>d<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">days_to_event=</span><span class="fu">c</span>(black,other),<span class="at">color_id=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">1000</span>),<span class="fu">rep</span>(<span class="dv">2</span>,<span class="dv">1000</span>)))</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>d<span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">adopted =</span> <span class="fu">if_else</span>(days_to_event <span class="sc">&gt;=</span> <span class="dv">200</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-46_1490648db346491df9b14aefbbbd3d22">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>data_list_2 <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">nrow</span>(d),</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">adopted =</span> d<span class="sc">$</span>adopted,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">days_to_event =</span> <span class="fu">as.numeric</span>(d<span class="sc">$</span>days_to_event),</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">color_id =</span> d<span class="sc">$</span>color_id</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-47_39c9d530abf4f40110bafcb6412124cd">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>fit_mod2 <span class="ot">&lt;-</span> modelo<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_list_2,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> <span class="fl">0.1</span>,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">step_size =</span> <span class="fl">0.01</span>,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>, </span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">200</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># show_messages = FALSE,</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># show_exceptions = FALSE</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 2 sequential chains...

Chain 1 Iteration:    1 / 3000 [  0%]  (Warmup) 
Chain 1 Iteration:  200 / 3000 [  6%]  (Warmup) 
Chain 1 Iteration:  400 / 3000 [ 13%]  (Warmup) 
Chain 1 Iteration:  600 / 3000 [ 20%]  (Warmup) 
Chain 1 Iteration:  800 / 3000 [ 26%]  (Warmup) 
Chain 1 Iteration: 1000 / 3000 [ 33%]  (Warmup) 
Chain 1 Iteration: 1001 / 3000 [ 33%]  (Sampling) 
Chain 1 Iteration: 1200 / 3000 [ 40%]  (Sampling) 
Chain 1 Iteration: 1400 / 3000 [ 46%]  (Sampling) 
Chain 1 Iteration: 1600 / 3000 [ 53%]  (Sampling) 
Chain 1 Iteration: 1800 / 3000 [ 60%]  (Sampling) 
Chain 1 Iteration: 2000 / 3000 [ 66%]  (Sampling) 
Chain 1 Iteration: 2200 / 3000 [ 73%]  (Sampling) 
Chain 1 Iteration: 2400 / 3000 [ 80%]  (Sampling) 
Chain 1 Iteration: 2600 / 3000 [ 86%]  (Sampling) 
Chain 1 Iteration: 2800 / 3000 [ 93%]  (Sampling) 
Chain 1 Iteration: 3000 / 3000 [100%]  (Sampling) 
Chain 1 finished in 3.3 seconds.
Chain 2 Iteration:    1 / 3000 [  0%]  (Warmup) 
Chain 2 Iteration:  200 / 3000 [  6%]  (Warmup) 
Chain 2 Iteration:  400 / 3000 [ 13%]  (Warmup) 
Chain 2 Iteration:  600 / 3000 [ 20%]  (Warmup) 
Chain 2 Iteration:  800 / 3000 [ 26%]  (Warmup) 
Chain 2 Iteration: 1000 / 3000 [ 33%]  (Warmup) 
Chain 2 Iteration: 1001 / 3000 [ 33%]  (Sampling) 
Chain 2 Iteration: 1200 / 3000 [ 40%]  (Sampling) 
Chain 2 Iteration: 1400 / 3000 [ 46%]  (Sampling) 
Chain 2 Iteration: 1600 / 3000 [ 53%]  (Sampling) 
Chain 2 Iteration: 1800 / 3000 [ 60%]  (Sampling) 
Chain 2 Iteration: 2000 / 3000 [ 66%]  (Sampling) 
Chain 2 Iteration: 2200 / 3000 [ 73%]  (Sampling) 
Chain 2 Iteration: 2400 / 3000 [ 80%]  (Sampling) 
Chain 2 Iteration: 2600 / 3000 [ 86%]  (Sampling) 
Chain 2 Iteration: 2800 / 3000 [ 93%]  (Sampling) 
Chain 2 Iteration: 3000 / 3000 [100%]  (Sampling) 
Chain 2 finished in 3.4 seconds.

Both chains finished successfully.
Mean chain execution time: 3.3 seconds.
Total execution time: 6.9 seconds.</code></pre>
</div>
</div>
<p><strong>graficar dias vs proporcion de gatos</strong></p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-48_eab779b10a865e116a064a1076931bd0">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>fit_mod2<span class="sc">$</span><span class="fu">summary</span>(<span class="fu">c</span>(<span class="st">"alpha"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 10
  variable  mean median     sd    mad    q5   q95  rhat ess_bulk ess_tail
  &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 alpha[1]  3.93   3.93 0.0314 0.0318  3.88  3.98  1.00    3868.    2716.
2 alpha[2]  3.51   3.51 0.0319 0.0317  3.46  3.56  1.00    3383.    2676.</code></pre>
</div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-49_a9e0d3cc6246e2cf63157ccc805debc2">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span><span class="fu">exp</span>(<span class="fl">3.92</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01984109</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span><span class="fu">exp</span>(<span class="fl">3.51</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02989691</code></pre>
</div>
</div>
</section>
</section>
<section id="propuesta-con-censurado-gabs-directo-de-repo-de-mcelreath" class="level2">
<h2 class="anchored" data-anchor-id="propuesta-con-censurado-gabs-directo-de-repo-de-mcelreath">Propuesta con censurado Gabs, directo de repo de McElreath</h2>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-50_75f3a07b467dbf55300181dfba8216cb">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>CATS <span class="ot">&lt;-</span> AustinCats</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>CAT_COLOR_ID <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(<span class="fu">ifelse</span>(CATS<span class="sc">$</span>color <span class="sc">!=</span> <span class="st">"Black"</span>, <span class="st">"Other"</span>, CATS<span class="sc">$</span>color)))</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>CAT_COLOR <span class="ot">&lt;-</span> <span class="fu">levels</span>(<span class="fu">as.factor</span>(<span class="fu">ifelse</span>(CATS<span class="sc">$</span>color <span class="sc">!=</span> <span class="st">"Black"</span>, <span class="st">"Other"</span>, CATS<span class="sc">$</span>color)))</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>ADOPTED_ID <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(<span class="fu">ifelse</span>(CATS<span class="sc">$</span>out_event <span class="sc">!=</span> <span class="st">"Adoption"</span>, <span class="st">"Other"</span>, <span class="st">"Adopted"</span>)))</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>ADOPTED <span class="ot">&lt;-</span> <span class="fu">levels</span>(<span class="fu">as.factor</span>(<span class="fu">ifelse</span>(CATS<span class="sc">$</span>out_event <span class="sc">!=</span> <span class="st">"Adoption"</span>, <span class="st">"Other"</span>, <span class="st">"Adopted"</span>)))</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>DAYS_TO_ADOPTION <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(CATS<span class="sc">$</span>days_to_event)</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>LAMBDA <span class="ot">&lt;-</span> <span class="dv">50</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-51_f82c9ae013572fad50f5ca7b14927617">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>stan_code <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=1&gt; N;               // number of data points</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=1&gt; K;               // number of categories</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; days_to_adoption[N]; // time to event</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=1, upper=K&gt; cat_color_id[N]; // categorical color id</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; lambda;         // rate parameter</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; right_censoring[N];  // right censoring times</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a><span class="st">  vector&lt;lower=0&gt;[K] alpha;     // scale parameters</span></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a><span class="st">  real gamma = 1 / lambda;</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a><span class="st">  alpha ~ exponential(gamma);   // prior for alpha</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a><span class="st">  for (n in 1:N) {</span></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a><span class="st">    if (days_to_adoption[n] == right_censoring[n]) {</span></span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a><span class="st">      target += exponential_lccdf(right_censoring[n] | 1 / alpha[cat_color_id[n]]);</span></span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a><span class="st">    } else {</span></span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a><span class="st">      days_to_adoption[n] ~ exponential(1 / alpha[cat_color_id[n]]);</span></span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos para el modelo</span></span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>right_censoring <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(ADOPTED_ID <span class="sc">==</span> <span class="dv">1</span>, <span class="fu">max</span>(DAYS_TO_ADOPTION), DAYS_TO_ADOPTION)</span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>data_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">length</span>(DAYS_TO_ADOPTION),</span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">K =</span> <span class="fu">length</span>(CAT_COLOR),</span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">days_to_adoption =</span> DAYS_TO_ADOPTION,</span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">cat_color_id =</span> CAT_COLOR_ID,</span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">lambda =</span> LAMBDA,</span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">right_censoring =</span> right_censoring</span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-41"><a href="#cb75-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-42"><a href="#cb75-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Compilar y ajustar el modelo</span></span>
<span id="cb75-43"><a href="#cb75-43" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">stan</span>(<span class="at">model_code =</span> stan_code, <span class="at">data =</span> data_list, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">chains =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 14.0.3 (clang-1403.0.22.14.1)’
using SDK: ‘MacOSX13.3.sdk’
clang -arch arm64 -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library/Rcpp/include/"  -I"/Users/gabyvenegas/Library/R/arm64/4.3/library/RcppEigen/include/"  -I"/Users/gabyvenegas/Library/R/arm64/4.3/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library/BH/include" -I"/Users/gabyvenegas/Library/R/arm64/4.3/library/StanHeaders/include/src/"  -I"/Users/gabyvenegas/Library/R/arm64/4.3/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library/RcppParallel/include/"  -I"/Users/gabyvenegas/Library/R/arm64/4.3/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Users/gabyvenegas/Library/R/arm64/4.3/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Users/gabyvenegas/Library/R/arm64/4.3/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Users/gabyvenegas/Library/R/arm64/4.3/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Users/gabyvenegas/Library/R/arm64/4.3/library/RcppEigen/include/Eigen/Core:19:
/Users/gabyvenegas/Library/R/arm64/4.3/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
#include &lt;cmath&gt;
         ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.001437 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 14.37 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 4.68 seconds (Warm-up)
Chain 1:                4.242 seconds (Sampling)
Chain 1:                8.922 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.000993 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 9.93 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 2: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 4.6 seconds (Warm-up)
Chain 2:                4.188 seconds (Sampling)
Chain 2:                8.788 seconds (Total)
Chain 2: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 3).
Chain 3: 
Chain 3: Gradient evaluation took 0.000986 seconds
Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 9.86 seconds.
Chain 3: Adjust your expectations accordingly!
Chain 3: 
Chain 3: 
Chain 3: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 3: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 3: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 3: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 3: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 3: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 3: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 3: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 3: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 3: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 3: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 3: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 3: 
Chain 3:  Elapsed Time: 4.516 seconds (Warm-up)
Chain 3:                4.289 seconds (Sampling)
Chain 3:                8.805 seconds (Total)
Chain 3: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 4).
Chain 4: 
Chain 4: Gradient evaluation took 0.000957 seconds
Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 9.57 seconds.
Chain 4: Adjust your expectations accordingly!
Chain 4: 
Chain 4: 
Chain 4: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 4: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 4: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 4: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 4: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 4: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 4: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 4: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 4: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 4: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 4: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 4: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 4: 
Chain 4:  Elapsed Time: 4.732 seconds (Warm-up)
Chain 4:                4.129 seconds (Sampling)
Chain 4:                8.861 seconds (Total)
Chain 4: </code></pre>
</div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-52_47df240f9fe52a97f3e82e8c7427a0fe">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Inference for Stan model: anon_model.
4 chains, each with iter=2000; warmup=1000; thin=1; 
post-warmup draws per chain=1000, total post-warmup draws=4000.

              mean se_mean   sd      2.5%       25%       50%       75%
alpha[1]     57.63    0.02 1.49     54.75     56.62     57.63     58.64
alpha[2]     48.47    0.01 0.48     47.52     48.15     48.45     48.78
lp__     -55650.62    0.02 0.99 -55653.26 -55651.01 -55650.31 -55649.91
             97.5% n_eff Rhat
alpha[1]     60.51  3837    1
alpha[2]     49.44  4299    1
lp__     -55649.67  1758    1

Samples were drawn using NUTS(diag_e) at Sun May 26 03:26:36 2024.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
</div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-53_5d957afedabc6ffe13519d2ba3f4d17e">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Paso 1: Extraer muestras y calcular intervalos de credibilidad</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Supongamos que ya tienes el objeto fit después de ajustar el modelo</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>posterior_samples <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">extract</span>(fit, <span class="at">pars =</span> <span class="st">"alpha"</span>)<span class="sc">$</span>alpha</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir las muestras a un data frame para facilitar la manipulación</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>posterior_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(posterior_samples)</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular los intervalos de credibilidad (High Density Intervals, HDIs)</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coda)</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>hdi <span class="ot">&lt;-</span> <span class="fu">apply</span>(posterior_df, <span class="dv">2</span>, <span class="cf">function</span>(x) {</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">HPDinterval</span>(<span class="fu">as.mcmc</span>(x), <span class="at">prob =</span> <span class="fl">0.89</span>)</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular la media de los parámetros</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">apply</span>(posterior_df, <span class="dv">2</span>, mean)</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar los datos para ggplot2</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">parameter =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(posterior_df), <span class="at">labels =</span> <span class="fu">paste0</span>(<span class="st">"alpha["</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(posterior_df), <span class="st">"]"</span>)),</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> means,</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">hdi_lower =</span> hdi[<span class="dv">1</span>, ],</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">hdi_upper =</span> hdi[<span class="dv">2</span>, ]</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Paso 2: Crear el gráfico forest plot</span></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> parameter, <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> hdi_lower, <span class="at">ymax =</span> hdi_upper), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span>  <span class="co"># Girar el gráfico para que sea horizontal</span></span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"days to adoption"</span>) <span class="sc">+</span></span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Proyecto_Final_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-54_e2ebdb198c6416fe748cd3dcdf69c1ff">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Paso 1: Extraer las muestras de `alpha` para cada categoría</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer las muestras del objeto `fit`</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>posterior_samples <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">extract</span>(fit, <span class="at">pars =</span> <span class="st">"alpha"</span>)<span class="sc">$</span>alpha</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir las muestras a un data frame para facilitar la manipulación</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>posterior_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(posterior_samples)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Añadir nombres de columnas para los colores de los gatos</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(posterior_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Black"</span>, <span class="st">"Other"</span>)</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Paso 2: Preparar los datos para `ggplot2`</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir el data frame a formato largo</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>posterior_long <span class="ot">&lt;-</span> posterior_df <span class="sc">%&gt;%</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"cat_color"</span>, <span class="at">values_to =</span> <span class="st">"alpha"</span>)</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Asignar colores para las categorías</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>posterior_long<span class="sc">$</span>color <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(posterior_long<span class="sc">$</span>cat_color <span class="sc">==</span> <span class="st">"Black"</span>, <span class="st">"black"</span>, <span class="st">"blue"</span>)</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Paso 3: Crear los gráficos de densidad con `ggplot2`</span></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el gráfico</span></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(posterior_long, <span class="fu">aes</span>(<span class="at">x =</span> alpha, <span class="at">fill =</span> cat_color, <span class="at">color =</span> cat_color)) <span class="sc">+</span></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Black"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"Other"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Black"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"Other"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"waiting time"</span>, <span class="at">y =</span> <span class="st">"density"</span>) <span class="sc">+</span></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Proyecto_Final_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-55_9d66f429ace0f1a02b95ddef42522b87">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Suponemos que el modelo ya se ha ajustado y tenemos el objeto fit</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar una secuencia de días</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>days_until_adoption_ <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>n_posterior_samples <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer las muestras del parámetro alpha del objeto fit</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>posterior_samples <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">extract</span>(fit, <span class="at">pars =</span> <span class="st">"alpha"</span>)<span class="sc">$</span>alpha</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir las muestras a un data frame para facilitar la manipulación</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>posterior_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(posterior_samples)</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(posterior_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Black"</span>, <span class="st">"Other"</span>)</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionar muestras posteriores para las categorías de colores</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>black_samples <span class="ot">&lt;-</span> posterior_df<span class="sc">$</span>Black[<span class="dv">1</span><span class="sc">:</span>n_posterior_samples]</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>other_samples <span class="ot">&lt;-</span> posterior_df<span class="sc">$</span>Other[<span class="dv">1</span><span class="sc">:</span>n_posterior_samples]</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un data frame para ggplot2</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar muestras de 'Black'</span></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (alpha <span class="cf">in</span> black_samples) {</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>  plot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(plot_data, <span class="fu">data.frame</span>(</span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">days =</span> days_until_adoption_,</span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">fraction =</span> <span class="fu">exp</span>(<span class="sc">-</span>days_until_adoption_ <span class="sc">/</span> alpha),</span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">cat_color =</span> <span class="st">"Black"</span>,</span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha_value =</span> alpha</span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar muestras de 'Other'</span></span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (alpha <span class="cf">in</span> other_samples) {</span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a>  plot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(plot_data, <span class="fu">data.frame</span>(</span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">days =</span> days_until_adoption_,</span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">fraction =</span> <span class="fu">exp</span>(<span class="sc">-</span>days_until_adoption_ <span class="sc">/</span> alpha),</span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">cat_color =</span> <span class="st">"Other"</span>,</span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha_value =</span> alpha</span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir cat_color a factor para ggplot2</span></span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true" tabindex="-1"></a>plot_data<span class="sc">$</span>cat_color <span class="ot">&lt;-</span> <span class="fu">factor</span>(plot_data<span class="sc">$</span>cat_color, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Black"</span>, <span class="st">"Other"</span>))</span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el gráfico</span></span>
<span id="cb82-45"><a href="#cb82-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb82-46"><a href="#cb82-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-47"><a href="#cb82-47" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> days, <span class="at">y =</span> fraction, <span class="at">group =</span> alpha_value, <span class="at">color =</span> cat_color)) <span class="sc">+</span></span>
<span id="cb82-48"><a href="#cb82-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb82-49"><a href="#cb82-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Black"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"Other"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb82-50"><a href="#cb82-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"days until adoption"</span>, <span class="at">y =</span> <span class="st">"fraction"</span>) <span class="sc">+</span></span>
<span id="cb82-51"><a href="#cb82-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb82-52"><a href="#cb82-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Proyecto_Final_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="con-breed-pero-queda-raro-no-me-convence" class="level2">
<h2 class="anchored" data-anchor-id="con-breed-pero-queda-raro-no-me-convence">con breed, pero queda raro, no me convence</h2>
</section>
<section id="modelo-con-datos-censurados-y-más-variables" class="level2">
<h2 class="anchored" data-anchor-id="modelo-con-datos-censurados-y-más-variables">Modelo con datos censurados y más variables</h2>
<section id="modelo-generativo-2" class="level3">
<h3 class="anchored" data-anchor-id="modelo-generativo-2">Modelo generativo</h3>
<p>Finalmente, vamos a agregar la variable de raza a nuestro modelo:</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-56_0253c5603ae11fa0e5f0d78e2b2b26df">
<div class="cell-output-display">
<div id="htmlwidget-705193ae996162a5055a" style="width:100%;height:780px;" class="grViz html-widget "></div>
<script type="application/json" data-for="htmlwidget-705193ae996162a5055a">{"x":{"diagram":"\ndigraph {\n  graph [ranksep = 0.2, rankdir = LR,bgcolor=ivory2]\n  node [shape=plaintext]\n  U [shape=circle]\n  C\n  D\n  A\n  edge [minlen = 3]\n  U -> A\n  R -> A\n  C -> A\n  A -> D\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-57_eedb58ee72f31916350a5be7e8a3538e">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">dagitty</span>( <span class="st">"dag {     U -&gt; A     C -&gt; A     A -&gt; D  R-&gt;A }"</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">impliedConditionalIndependencies</span>(g1, <span class="at">type =</span> <span class="st">"all.pairs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C _||_ D | A
C _||_ D | A, R
C _||_ D | A, U
C _||_ D | A, R, U
C _||_ R
C _||_ R | U
C _||_ U
C _||_ U | R
D _||_ R | A
D _||_ R | A, C
D _||_ R | A, U
D _||_ R | A, C, U
D _||_ U | A
D _||_ U | A, C
D _||_ U | A, R
D _||_ U | A, C, R
R _||_ U
R _||_ U | C</code></pre>
</div>
</div>
</section>
<section id="cantidad-a-estimar-2" class="level3">
<h3 class="anchored" data-anchor-id="cantidad-a-estimar-2">Cantidad a estimar</h3>
<p>Estimar el número de días <span class="math inline">\(D\)</span> que le toma a un gato esperar para ser adoptado, esta vez utilizaremos tanto los datos censurados como no censurados. Tomando en cuenta nuestras nuevas variables binarias para color y raza.</p>
</section>
<section id="proceso-estadístico-2" class="level3">
<h3 class="anchored" data-anchor-id="proceso-estadístico-2">Proceso estadístico</h3>
<p>Usamos el mismo proceso de modelo censurado</p>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-58_7893f7e00642d7aa94744016f70dc70c">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co">#falta poner var de raza</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math display">\[f(y)=\lambda e^{\lambda y}\]</span></p>
<p><span class="math display">\[E[y]=\frac{1}{\lambda}\]</span></p>
<p><span class="math display">\[D_i | A_i = 1 \sim \exp(\lambda_i)\]</span> <span class="math display">\[D_i | A_i = 0 \sim \exp CCDF(\lambda_i)\]</span></p>
<p><span class="math display">\[\lambda_i = 1/\mu_i\]</span></p>
<p><span class="math display">\[log \mu_i = \alpha_{Color_i}\]</span> <span class="math display">\[\alpha_{Color} \sim N(0,1)\]</span></p>
<ul>
<li><p><span class="math inline">\(D_i | A_i = 1\)</span> - adopciones observadas</p></li>
<li><p><span class="math inline">\(D_i | A_i = 1\)</span> - adopciones aun no observadas</p></li>
<li><p><span class="math inline">\(\alpha_{\text{cat color}[i]}\)</span> - <span class="math inline">\(log\mu\)</span> tiempo de adopción para cada color</p></li>
<li><p><span class="math inline">\(\log \mu_i\)</span> - función liga para garantizar <span class="math inline">\(\alpha\)</span> positivos</p></li>
<li><p><span class="math inline">\(\lambda_i = \frac{1}{\mu_i}\)</span> tiempo promedio adopción</p></li>
</ul>
</section>
<section id="analizar-los-datos-y-resumir-resultados" class="level3">
<h3 class="anchored" data-anchor-id="analizar-los-datos-y-resumir-resultados">Analizar los datos y resumir resultados</h3>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-59_c0dd940a393b900dd22e329e3664f629">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar los paquetes necesarios</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coda)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Factorizar las columnas categóricas</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>CAT_COLOR_ID <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(<span class="fu">ifelse</span>(CATS<span class="sc">$</span>color <span class="sc">!=</span> <span class="st">"Black"</span>, <span class="st">"Other"</span>, CATS<span class="sc">$</span>color)))</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>CAT_COLOR <span class="ot">&lt;-</span> <span class="fu">levels</span>(<span class="fu">as.factor</span>(<span class="fu">ifelse</span>(CATS<span class="sc">$</span>color <span class="sc">!=</span> <span class="st">"Black"</span>, <span class="st">"Other"</span>, CATS<span class="sc">$</span>color)))</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>ADOPTED_ID <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(<span class="fu">ifelse</span>(CATS<span class="sc">$</span>out_event <span class="sc">!=</span> <span class="st">"Adoption"</span>, <span class="st">"Other"</span>, <span class="st">"Adopted"</span>)))</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>ADOPTED <span class="ot">&lt;-</span> <span class="fu">levels</span>(<span class="fu">as.factor</span>(<span class="fu">ifelse</span>(CATS<span class="sc">$</span>out_event <span class="sc">!=</span> <span class="st">"Adoption"</span>, <span class="st">"Other"</span>, <span class="st">"Adopted"</span>)))</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Factorizar la nueva columna 'raza'</span></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>CATS<span class="sc">$</span>raza <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(CATS<span class="sc">$</span>raza <span class="sc">==</span> <span class="st">"domestico"</span>, <span class="st">"domestico"</span>, <span class="st">"otro"</span>)</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>CAT_RAZA_ID <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(CATS<span class="sc">$</span>raza))</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>CAT_RAZA <span class="ot">&lt;-</span> <span class="fu">levels</span>(<span class="fu">as.factor</span>(CATS<span class="sc">$</span>raza))</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>DAYS_TO_ADOPTION <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(CATS<span class="sc">$</span>days_to_event)</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>LAMBDA <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>LAMBDA2 <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar el modelo en rstan</span></span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>stan_code <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=1&gt; N;               // number of data points</span></span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=1&gt; K;               // number of color categories</span></span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=1&gt; M;               // number of raza categories</span></span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; days_to_adoption[N]; // time to event</span></span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=1, upper=K&gt; cat_color_id[N]; // categorical color id</span></span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=1, upper=M&gt; cat_raza_id[N]; // categorical raza id</span></span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; lambda;         // rate parameter</span></span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; lambda2;         // rate parameter</span></span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; right_censoring[N];  // right censoring times</span></span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a><span class="st">  vector&lt;lower=0&gt;[K] alpha;     // scale parameters for colors</span></span>
<span id="cb86-42"><a href="#cb86-42" aria-hidden="true" tabindex="-1"></a><span class="st">  vector&lt;lower=0&gt;[M] beta;      // scale parameters for raza</span></span>
<span id="cb86-43"><a href="#cb86-43" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb86-44"><a href="#cb86-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-45"><a href="#cb86-45" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb86-46"><a href="#cb86-46" aria-hidden="true" tabindex="-1"></a><span class="st">  real gamma = 1 / lambda;</span></span>
<span id="cb86-47"><a href="#cb86-47" aria-hidden="true" tabindex="-1"></a><span class="st">  real gamma2 = 1 / lambda2;</span></span>
<span id="cb86-48"><a href="#cb86-48" aria-hidden="true" tabindex="-1"></a><span class="st">  alpha ~ exponential(gamma);   // prior for alpha</span></span>
<span id="cb86-49"><a href="#cb86-49" aria-hidden="true" tabindex="-1"></a><span class="st">  beta ~ exponential(gamma2);    // prior for beta</span></span>
<span id="cb86-50"><a href="#cb86-50" aria-hidden="true" tabindex="-1"></a><span class="st">  for (n in 1:N) {</span></span>
<span id="cb86-51"><a href="#cb86-51" aria-hidden="true" tabindex="-1"></a><span class="st">    if (days_to_adoption[n] == right_censoring[n]) {</span></span>
<span id="cb86-52"><a href="#cb86-52" aria-hidden="true" tabindex="-1"></a><span class="st">      target += exponential_lccdf(right_censoring[n] | 1 / (alpha[cat_color_id[n]] * beta[cat_raza_id[n]]));</span></span>
<span id="cb86-53"><a href="#cb86-53" aria-hidden="true" tabindex="-1"></a><span class="st">    } else {</span></span>
<span id="cb86-54"><a href="#cb86-54" aria-hidden="true" tabindex="-1"></a><span class="st">      days_to_adoption[n] ~ exponential(1 / (alpha[cat_color_id[n]] * beta[cat_raza_id[n]]));</span></span>
<span id="cb86-55"><a href="#cb86-55" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb86-56"><a href="#cb86-56" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb86-57"><a href="#cb86-57" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb86-58"><a href="#cb86-58" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb86-59"><a href="#cb86-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-60"><a href="#cb86-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos para el modelo</span></span>
<span id="cb86-61"><a href="#cb86-61" aria-hidden="true" tabindex="-1"></a>right_censoring <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(ADOPTED_ID <span class="sc">==</span> <span class="dv">1</span>, <span class="fu">max</span>(DAYS_TO_ADOPTION), DAYS_TO_ADOPTION)</span>
<span id="cb86-62"><a href="#cb86-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-63"><a href="#cb86-63" aria-hidden="true" tabindex="-1"></a>data_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb86-64"><a href="#cb86-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">length</span>(DAYS_TO_ADOPTION),</span>
<span id="cb86-65"><a href="#cb86-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">K =</span> <span class="fu">length</span>(CAT_COLOR),</span>
<span id="cb86-66"><a href="#cb86-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">M =</span> <span class="fu">length</span>(CAT_RAZA),</span>
<span id="cb86-67"><a href="#cb86-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">days_to_adoption =</span> DAYS_TO_ADOPTION,</span>
<span id="cb86-68"><a href="#cb86-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">cat_color_id =</span> CAT_COLOR_ID,</span>
<span id="cb86-69"><a href="#cb86-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">cat_raza_id =</span> CAT_RAZA_ID,</span>
<span id="cb86-70"><a href="#cb86-70" aria-hidden="true" tabindex="-1"></a>  <span class="at">lambda =</span> LAMBDA,</span>
<span id="cb86-71"><a href="#cb86-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">lambda2 =</span> LAMBDA2,</span>
<span id="cb86-72"><a href="#cb86-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">right_censoring =</span> right_censoring</span>
<span id="cb86-73"><a href="#cb86-73" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-74"><a href="#cb86-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-75"><a href="#cb86-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Compilar y ajustar el modelo</span></span>
<span id="cb86-76"><a href="#cb86-76" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">stan</span>(<span class="at">model_code =</span> stan_code, <span class="at">data =</span> data_list, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">chains =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 14.0.3 (clang-1403.0.22.14.1)’
using SDK: ‘MacOSX13.3.sdk’
clang -arch arm64 -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library/Rcpp/include/"  -I"/Users/gabyvenegas/Library/R/arm64/4.3/library/RcppEigen/include/"  -I"/Users/gabyvenegas/Library/R/arm64/4.3/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library/BH/include" -I"/Users/gabyvenegas/Library/R/arm64/4.3/library/StanHeaders/include/src/"  -I"/Users/gabyvenegas/Library/R/arm64/4.3/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library/RcppParallel/include/"  -I"/Users/gabyvenegas/Library/R/arm64/4.3/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Users/gabyvenegas/Library/R/arm64/4.3/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Users/gabyvenegas/Library/R/arm64/4.3/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Users/gabyvenegas/Library/R/arm64/4.3/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Users/gabyvenegas/Library/R/arm64/4.3/library/RcppEigen/include/Eigen/Core:19:
/Users/gabyvenegas/Library/R/arm64/4.3/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
#include &lt;cmath&gt;
         ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.001672 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 16.72 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 143.262 seconds (Warm-up)
Chain 1:                152.137 seconds (Sampling)
Chain 1:                295.399 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.001141 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 11.41 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 2: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 138.786 seconds (Warm-up)
Chain 2:                165.668 seconds (Sampling)
Chain 2:                304.454 seconds (Total)
Chain 2: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 3).
Chain 3: 
Chain 3: Gradient evaluation took 0.00118 seconds
Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 11.8 seconds.
Chain 3: Adjust your expectations accordingly!
Chain 3: 
Chain 3: 
Chain 3: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 3: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 3: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 3: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 3: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 3: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 3: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 3: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 3: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 3: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 3: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 3: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 3: 
Chain 3:  Elapsed Time: 135.374 seconds (Warm-up)
Chain 3:                160.244 seconds (Sampling)
Chain 3:                295.618 seconds (Total)
Chain 3: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 4).
Chain 4: 
Chain 4: Gradient evaluation took 0.001143 seconds
Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 11.43 seconds.
Chain 4: Adjust your expectations accordingly!
Chain 4: 
Chain 4: 
Chain 4: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 4: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 4: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 4: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 4: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 4: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 4: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 4: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 4: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 4: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 4: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 4: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 4: 
Chain 4:  Elapsed Time: 137.676 seconds (Warm-up)
Chain 4:                176.41 seconds (Sampling)
Chain 4:                314.086 seconds (Total)
Chain 4: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#tail-ess</code></pre>
</div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-60_c6ba51099ed127b15ed98cb5434bb257">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Inference for Stan model: anon_model.
4 chains, each with iter=2000; warmup=1000; thin=1; 
post-warmup draws per chain=1000, total post-warmup draws=4000.

              mean se_mean    sd      2.5%       25%       50%       75%
alpha[1]     13.53    0.99 16.15      1.18      3.59      7.30     17.18
alpha[2]     11.41    0.83 13.61      0.99      3.04      6.17     14.47
beta[1]      12.37    0.79 13.36      0.91      3.41      8.02     16.20
beta[2]      11.36    0.72 12.26      0.84      3.15      7.35     14.94
lp__     -55651.00    0.04  1.27 -55654.17 -55651.67 -55650.72 -55650.05
             97.5% n_eff Rhat
alpha[1]     64.24   266 1.01
alpha[2]     54.31   268 1.01
beta[1]      49.85   287 1.03
beta[2]      45.36   286 1.03
lp__     -55649.40   812 1.01

Samples were drawn using NUTS(diag_e) at Sun May 26 03:47:10 2024.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
</div>
</div>
</section>
<section id="revisar-cómputos-y-resultado-del-modelo-1" class="level3">
<h3 class="anchored" data-anchor-id="revisar-cómputos-y-resultado-del-modelo-1">Revisar cómputos y resultado del modelo</h3>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-61_e99e0815d12b264e11d895b788d16cc4">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer las muestras de 'alpha' y 'beta'</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>posterior_samples_alpha <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">extract</span>(fit, <span class="at">pars =</span> <span class="st">"alpha"</span>)<span class="sc">$</span>alpha</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>posterior_samples_beta <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">extract</span>(fit, <span class="at">pars =</span> <span class="st">"beta"</span>)<span class="sc">$</span>beta</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir las muestras a data frames para facilitar la manipulación</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>posterior_df_alpha <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(posterior_samples_alpha)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>posterior_df_beta <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(posterior_samples_beta)</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Añadir nombres de columnas para las categorías de color y raza</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(posterior_df_alpha) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Black"</span>, <span class="st">"Other"</span>)</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(posterior_df_beta) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"domestico"</span>, <span class="st">"otro"</span>)</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionar muestras posteriores para las categorías de colores y raza</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>n_posterior_samples <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>black_samples <span class="ot">&lt;-</span> posterior_df_alpha<span class="sc">$</span>Black[<span class="dv">1</span><span class="sc">:</span>n_posterior_samples]</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>other_samples <span class="ot">&lt;-</span> posterior_df_alpha<span class="sc">$</span>Other[<span class="dv">1</span><span class="sc">:</span>n_posterior_samples]</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>domestico_samples <span class="ot">&lt;-</span> posterior_df_beta<span class="sc">$</span>domestico[<span class="dv">1</span><span class="sc">:</span>n_posterior_samples]</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>otro_samples <span class="ot">&lt;-</span> posterior_df_beta<span class="sc">$</span>otro[<span class="dv">1</span><span class="sc">:</span>n_posterior_samples]</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar una secuencia de días</span></span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>days_until_adoption_ <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un data frame para ggplot2</span></span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar muestras de combinaciones de 'Black' y 'domestico'/'otro'</span></span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (alpha <span class="cf">in</span> black_samples) {</span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (beta <span class="cf">in</span> domestico_samples) {</span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a>    plot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(plot_data, <span class="fu">data.frame</span>(</span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">days =</span> days_until_adoption_,</span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">fraction =</span> <span class="fu">exp</span>(<span class="sc">-</span>days_until_adoption_ <span class="sc">/</span> (alpha <span class="sc">*</span> beta)),</span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">cat_color =</span> <span class="st">"Black"</span>,</span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">cat_raza =</span> <span class="st">"domestico"</span>,</span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">alpha_value =</span> alpha,</span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">beta_value =</span> beta</span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb93-38"><a href="#cb93-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (beta <span class="cf">in</span> otro_samples) {</span>
<span id="cb93-39"><a href="#cb93-39" aria-hidden="true" tabindex="-1"></a>    plot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(plot_data, <span class="fu">data.frame</span>(</span>
<span id="cb93-40"><a href="#cb93-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">days =</span> days_until_adoption_,</span>
<span id="cb93-41"><a href="#cb93-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">fraction =</span> <span class="fu">exp</span>(<span class="sc">-</span>days_until_adoption_ <span class="sc">/</span> (alpha <span class="sc">*</span> beta)),</span>
<span id="cb93-42"><a href="#cb93-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">cat_color =</span> <span class="st">"Black"</span>,</span>
<span id="cb93-43"><a href="#cb93-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">cat_raza =</span> <span class="st">"otro"</span>,</span>
<span id="cb93-44"><a href="#cb93-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">alpha_value =</span> alpha,</span>
<span id="cb93-45"><a href="#cb93-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">beta_value =</span> beta</span>
<span id="cb93-46"><a href="#cb93-46" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb93-47"><a href="#cb93-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb93-48"><a href="#cb93-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-49"><a href="#cb93-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-50"><a href="#cb93-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar muestras de combinaciones de 'Other' y 'domestico'/'otro'</span></span>
<span id="cb93-51"><a href="#cb93-51" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (alpha <span class="cf">in</span> other_samples) {</span>
<span id="cb93-52"><a href="#cb93-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (beta <span class="cf">in</span> domestico_samples) {</span>
<span id="cb93-53"><a href="#cb93-53" aria-hidden="true" tabindex="-1"></a>    plot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(plot_data, <span class="fu">data.frame</span>(</span>
<span id="cb93-54"><a href="#cb93-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">days =</span> days_until_adoption_,</span>
<span id="cb93-55"><a href="#cb93-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">fraction =</span> <span class="fu">exp</span>(<span class="sc">-</span>days_until_adoption_ <span class="sc">/</span> (alpha <span class="sc">*</span> beta)),</span>
<span id="cb93-56"><a href="#cb93-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">cat_color =</span> <span class="st">"Other"</span>,</span>
<span id="cb93-57"><a href="#cb93-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">cat_raza =</span> <span class="st">"domestico"</span>,</span>
<span id="cb93-58"><a href="#cb93-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">alpha_value =</span> alpha,</span>
<span id="cb93-59"><a href="#cb93-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">beta_value =</span> beta</span>
<span id="cb93-60"><a href="#cb93-60" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb93-61"><a href="#cb93-61" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb93-62"><a href="#cb93-62" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (beta <span class="cf">in</span> otro_samples) {</span>
<span id="cb93-63"><a href="#cb93-63" aria-hidden="true" tabindex="-1"></a>    plot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(plot_data, <span class="fu">data.frame</span>(</span>
<span id="cb93-64"><a href="#cb93-64" aria-hidden="true" tabindex="-1"></a>      <span class="at">days =</span> days_until_adoption_,</span>
<span id="cb93-65"><a href="#cb93-65" aria-hidden="true" tabindex="-1"></a>      <span class="at">fraction =</span> <span class="fu">exp</span>(<span class="sc">-</span>days_until_adoption_ <span class="sc">/</span> (alpha <span class="sc">*</span> beta)),</span>
<span id="cb93-66"><a href="#cb93-66" aria-hidden="true" tabindex="-1"></a>      <span class="at">cat_color =</span> <span class="st">"Other"</span>,</span>
<span id="cb93-67"><a href="#cb93-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">cat_raza =</span> <span class="st">"otro"</span>,</span>
<span id="cb93-68"><a href="#cb93-68" aria-hidden="true" tabindex="-1"></a>      <span class="at">alpha_value =</span> alpha,</span>
<span id="cb93-69"><a href="#cb93-69" aria-hidden="true" tabindex="-1"></a>      <span class="at">beta_value =</span> beta</span>
<span id="cb93-70"><a href="#cb93-70" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb93-71"><a href="#cb93-71" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb93-72"><a href="#cb93-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-73"><a href="#cb93-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-74"><a href="#cb93-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir cat_color y cat_raza a factores para ggplot2</span></span>
<span id="cb93-75"><a href="#cb93-75" aria-hidden="true" tabindex="-1"></a>plot_data<span class="sc">$</span>cat_color <span class="ot">&lt;-</span> <span class="fu">factor</span>(plot_data<span class="sc">$</span>cat_color, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Black"</span>, <span class="st">"Other"</span>))</span>
<span id="cb93-76"><a href="#cb93-76" aria-hidden="true" tabindex="-1"></a>plot_data<span class="sc">$</span>cat_raza <span class="ot">&lt;-</span> <span class="fu">factor</span>(plot_data<span class="sc">$</span>cat_raza, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"domestico"</span>, <span class="st">"otro"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-62_0d333d25ef435370a87eb504cb3eada3">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> days, <span class="at">y =</span> fraction, <span class="at">group =</span> <span class="fu">interaction</span>(alpha_value, beta_value), <span class="at">color =</span> cat_color)) <span class="sc">+</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> cat_raza) <span class="sc">+</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Black"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"Other"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"days until adoption"</span>, <span class="at">y =</span> <span class="st">"fraction"</span>) <span class="sc">+</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Proyecto_Final_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="Proyecto_Final_cache/html/unnamed-chunk-63_db253fe35bdeaeb79a0bb64c53ed8ebc">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co">#falta conclusiones</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="conclusiones" class="level1">
<h1>Conclusiones</h1>
<ul>
<li><p>Para el modelo sin datos censurados</p></li>
<li><p>El modelo con datos censurados y no censurados</p></li>
<li><p>El tercer modelo que además de tomar en cuenta los datos censurados añade as variables de</p></li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>